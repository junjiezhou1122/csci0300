"use strict";var Je=Object.defineProperty;var Ye=(i,e)=>{for(var n in e)Je(i,n,{get:e[n],enumerable:!0})};var $e=require("worker_threads");var _e={};Ye(_e,{computeDiff:()=>gn});var fe=class{constructor(){this.listeners=[],this.unexpectedErrorHandler=function(e){setTimeout(()=>{throw e.stack?ne.isErrorNoTelemetry(e)?new ne(e.message+`

`+e.stack):new Error(e.message+`

`+e.stack):e},0)}}addListener(e){return this.listeners.push(e),()=>{this._removeListener(e)}}emit(e){this.listeners.forEach(n=>{n(e)})}_removeListener(e){this.listeners.splice(this.listeners.indexOf(e),1)}setUnexpectedErrorHandler(e){this.unexpectedErrorHandler=e}getUnexpectedErrorHandler(){return this.unexpectedErrorHandler}onUnexpectedError(e){this.unexpectedErrorHandler(e),this.emit(e)}onUnexpectedExternalError(e){this.unexpectedErrorHandler(e)}},Ze=new fe;function Ee(i){Qe(i)||Ze.onUnexpectedError(i)}var ge="Canceled";function Qe(i){return i instanceof ee?!0:i instanceof Error&&i.name===ge&&i.message===ge}var ee=class extends Error{constructor(){super(ge),this.name=this.message}};var ne=class i extends Error{constructor(e){super(e),this.name="CodeExpectedError"}static fromError(e){if(e instanceof i)return e;let n=new i;return n.message=e.message,n.stack=e.stack,n}static isErrorNoTelemetry(e){return e.name==="CodeExpectedError"}},S=class i extends Error{constructor(e){super(e||"An unexpected bug occurred."),Object.setPrototypeOf(this,i.prototype)}};function O(i,e){let n=U(i,e);return n===-1?void 0:i[n]}function U(i,e,n=0,t=i.length){let r=n,o=t;for(;r<o;){let s=Math.floor((r+o)/2);e(i[s])?r=s+1:o=s}return r-1}function Te(i,e){let n=j(i,e);return n===i.length?void 0:i[n]}function j(i,e,n=0,t=i.length){let r=n,o=t;for(;r<o;){let s=Math.floor((r+o)/2);e(i[s])?o=s:r=s+1}return r}var H=class i{constructor(e){this._array=e;this._findLastMonotonousLastIdx=0}static{this.assertInvariants=!1}findLastMonotonous(e){if(i.assertInvariants){if(this._prevFindLastPredicate){for(let t of this._array)if(this._prevFindLastPredicate(t)&&!e(t))throw new Error("MonotonousArray: current predicate must be weaker than (or equal to) the previous predicate.")}this._prevFindLastPredicate=e}let n=U(this._array,e,this._findLastMonotonousLastIdx);return this._findLastMonotonousLastIdx=n+1,n===-1?void 0:this._array[n]}};function Ne(i,e,n=(t,r)=>t===r){if(i===e)return!0;if(!i||!e||i.length!==e.length)return!1;for(let t=0,r=i.length;t<r;t++)if(!n(i[t],e[t]))return!1;return!0}function*Ie(i,e){let n,t;for(let r of i)t!==void 0&&e(t,r)?n.push(r):(n&&(yield n),n=[r]),t=r;n&&(yield n)}function ye(i,e){for(let n=0;n<=i.length;n++)e(n===0?void 0:i[n-1],n===i.length?void 0:i[n])}function we(i,e){for(let n=0;n<i.length;n++)e(n===0?void 0:i[n-1],i[n],n+1===i.length?void 0:i[n+1])}function Se(i,e){for(let n of e)i.push(n)}var Ae;(u=>{function i(l){return l<0}u.isLessThan=i;function e(l){return l<=0}u.isLessThanOrEqual=e;function n(l){return l>0}u.isGreaterThan=n;function t(l){return l===0}u.isNeitherLessOrGreaterThan=t,u.greaterThan=1,u.lessThan=-1,u.neitherLessOrGreaterThan=0})(Ae||={});function $(i,e){return(n,t)=>e(i(n),i(t))}var X=(i,e)=>i-e;function Me(i){return(e,n)=>-i(e,n)}var ve=class i{constructor(e){this.iterate=e}static{this.empty=new i(e=>{})}forEach(e){this.iterate(n=>(e(n),!0))}toArray(){let e=[];return this.iterate(n=>(e.push(n),!0)),e}filter(e){return new i(n=>this.iterate(t=>e(t)?n(t):!0))}map(e){return new i(n=>this.iterate(t=>n(e(t))))}some(e){let n=!1;return this.iterate(t=>(n=e(t),!n)),n}findFirst(e){let n;return this.iterate(t=>e(t)?(n=t,!1):!0),n}findLast(e){let n;return this.iterate(t=>(e(t)&&(n=t),!0)),n}findLastMaxBy(e){let n,t=!0;return this.iterate(r=>((t||Ae.isGreaterThan(e(r,n)))&&(t=!1,n=r),!0)),n}};function J(i){if(!i()){debugger;i(),Ee(new S("Assertion Failed"))}}function be(i,e){let n=0;for(;n<i.length-1;){let t=i[n],r=i[n+1];if(!e(t,r))return!1;n++}return!0}var R=class i{constructor(e,n){this.start=e;this.endExclusive=n;if(e>n)throw new S(`Invalid range: ${this.toString()}`)}static addRange(e,n){let t=0;for(;t<n.length&&n[t].endExclusive<e.start;)t++;let r=t;for(;r<n.length&&n[r].start<=e.endExclusive;)r++;if(t===r)n.splice(t,0,e);else{let o=Math.min(e.start,n[t].start),s=Math.max(e.endExclusive,n[r-1].endExclusive);n.splice(t,r-t,new i(o,s))}}static tryCreate(e,n){if(!(e>n))return new i(e,n)}static ofLength(e){return new i(0,e)}static ofStartAndLength(e,n){return new i(e,e+n)}get isEmpty(){return this.start===this.endExclusive}delta(e){return new i(this.start+e,this.endExclusive+e)}deltaStart(e){return new i(this.start+e,this.endExclusive)}deltaEnd(e){return new i(this.start,this.endExclusive+e)}get length(){return this.endExclusive-this.start}toString(){return`[${this.start}, ${this.endExclusive})`}equals(e){return this.start===e.start&&this.endExclusive===e.endExclusive}containsRange(e){return this.start<=e.start&&e.endExclusive<=this.endExclusive}contains(e){return this.start<=e&&e<this.endExclusive}join(e){return new i(Math.min(this.start,e.start),Math.max(this.endExclusive,e.endExclusive))}intersect(e){let n=Math.max(this.start,e.start),t=Math.min(this.endExclusive,e.endExclusive);if(n<=t)return new i(n,t)}intersects(e){let n=Math.max(this.start,e.start),t=Math.min(this.endExclusive,e.endExclusive);return n<t}intersectsOrTouches(e){let n=Math.max(this.start,e.start),t=Math.min(this.endExclusive,e.endExclusive);return n<=t}isBefore(e){return this.endExclusive<=e.start}isAfter(e){return this.start>=e.endExclusive}slice(e){return e.slice(this.start,this.endExclusive)}substring(e){return e.substring(this.start,this.endExclusive)}clip(e){if(this.isEmpty)throw new S(`Invalid clipping range: ${this.toString()}`);return Math.max(this.start,Math.min(this.endExclusive-1,e))}clipCyclic(e){if(this.isEmpty)throw new S(`Invalid clipping range: ${this.toString()}`);return e<this.start?this.endExclusive-(this.start-e)%this.length:e>=this.endExclusive?this.start+(e-this.start)%this.length:e}map(e){let n=[];for(let t=this.start;t<this.endExclusive;t++)n.push(e(t));return n}forEach(e){for(let n=this.start;n<this.endExclusive;n++)e(n)}};var A=class i{constructor(e,n){this.lineNumber=e,this.column=n}with(e=this.lineNumber,n=this.column){return e===this.lineNumber&&n===this.column?this:new i(e,n)}delta(e=0,n=0){return this.with(this.lineNumber+e,this.column+n)}equals(e){return i.equals(this,e)}static equals(e,n){return!e&&!n?!0:!!e&&!!n&&e.lineNumber===n.lineNumber&&e.column===n.column}isBefore(e){return i.isBefore(this,e)}static isBefore(e,n){return e.lineNumber<n.lineNumber?!0:n.lineNumber<e.lineNumber?!1:e.column<n.column}isBeforeOrEqual(e){return i.isBeforeOrEqual(this,e)}static isBeforeOrEqual(e,n){return e.lineNumber<n.lineNumber?!0:n.lineNumber<e.lineNumber?!1:e.column<=n.column}static compare(e,n){let t=e.lineNumber|0,r=n.lineNumber|0;if(t===r){let o=e.column|0,s=n.column|0;return o-s}return t-r}clone(){return new i(this.lineNumber,this.column)}toString(){return"("+this.lineNumber+","+this.column+")"}static lift(e){return new i(e.lineNumber,e.column)}static isIPosition(e){return e&&typeof e.lineNumber=="number"&&typeof e.column=="number"}toJSON(){return{lineNumber:this.lineNumber,column:this.column}}};var I=class i{constructor(e,n,t,r){e>t||e===t&&n>r?(this.startLineNumber=t,this.startColumn=r,this.endLineNumber=e,this.endColumn=n):(this.startLineNumber=e,this.startColumn=n,this.endLineNumber=t,this.endColumn=r)}isEmpty(){return i.isEmpty(this)}static isEmpty(e){return e.startLineNumber===e.endLineNumber&&e.startColumn===e.endColumn}containsPosition(e){return i.containsPosition(this,e)}static containsPosition(e,n){return!(n.lineNumber<e.startLineNumber||n.lineNumber>e.endLineNumber||n.lineNumber===e.startLineNumber&&n.column<e.startColumn||n.lineNumber===e.endLineNumber&&n.column>e.endColumn)}static strictContainsPosition(e,n){return!(n.lineNumber<e.startLineNumber||n.lineNumber>e.endLineNumber||n.lineNumber===e.startLineNumber&&n.column<=e.startColumn||n.lineNumber===e.endLineNumber&&n.column>=e.endColumn)}containsRange(e){return i.containsRange(this,e)}static containsRange(e,n){return!(n.startLineNumber<e.startLineNumber||n.endLineNumber<e.startLineNumber||n.startLineNumber>e.endLineNumber||n.endLineNumber>e.endLineNumber||n.startLineNumber===e.startLineNumber&&n.startColumn<e.startColumn||n.endLineNumber===e.endLineNumber&&n.endColumn>e.endColumn)}strictContainsRange(e){return i.strictContainsRange(this,e)}static strictContainsRange(e,n){return!(n.startLineNumber<e.startLineNumber||n.endLineNumber<e.startLineNumber||n.startLineNumber>e.endLineNumber||n.endLineNumber>e.endLineNumber||n.startLineNumber===e.startLineNumber&&n.startColumn<=e.startColumn||n.endLineNumber===e.endLineNumber&&n.endColumn>=e.endColumn)}plusRange(e){return i.plusRange(this,e)}static plusRange(e,n){let t,r,o,s;return n.startLineNumber<e.startLineNumber?(t=n.startLineNumber,r=n.startColumn):n.startLineNumber===e.startLineNumber?(t=n.startLineNumber,r=Math.min(n.startColumn,e.startColumn)):(t=e.startLineNumber,r=e.startColumn),n.endLineNumber>e.endLineNumber?(o=n.endLineNumber,s=n.endColumn):n.endLineNumber===e.endLineNumber?(o=n.endLineNumber,s=Math.max(n.endColumn,e.endColumn)):(o=e.endLineNumber,s=e.endColumn),new i(t,r,o,s)}intersectRanges(e){return i.intersectRanges(this,e)}static intersectRanges(e,n){let t=e.startLineNumber,r=e.startColumn,o=e.endLineNumber,s=e.endColumn,u=n.startLineNumber,l=n.startColumn,a=n.endLineNumber,m=n.endColumn;return t<u?(t=u,r=l):t===u&&(r=Math.max(r,l)),o>a?(o=a,s=m):o===a&&(s=Math.min(s,m)),t>o||t===o&&r>s?null:new i(t,r,o,s)}equalsRange(e){return i.equalsRange(this,e)}static equalsRange(e,n){return!e&&!n?!0:!!e&&!!n&&e.startLineNumber===n.startLineNumber&&e.startColumn===n.startColumn&&e.endLineNumber===n.endLineNumber&&e.endColumn===n.endColumn}getEndPosition(){return i.getEndPosition(this)}static getEndPosition(e){return new A(e.endLineNumber,e.endColumn)}getStartPosition(){return i.getStartPosition(this)}static getStartPosition(e){return new A(e.startLineNumber,e.startColumn)}toString(){return"["+this.startLineNumber+","+this.startColumn+" -> "+this.endLineNumber+","+this.endColumn+"]"}setEndPosition(e,n){return new i(this.startLineNumber,this.startColumn,e,n)}setStartPosition(e,n){return new i(e,n,this.endLineNumber,this.endColumn)}collapseToStart(){return i.collapseToStart(this)}static collapseToStart(e){return new i(e.startLineNumber,e.startColumn,e.startLineNumber,e.startColumn)}collapseToEnd(){return i.collapseToEnd(this)}static collapseToEnd(e){return new i(e.endLineNumber,e.endColumn,e.endLineNumber,e.endColumn)}delta(e){return new i(this.startLineNumber+e,this.startColumn,this.endLineNumber+e,this.endColumn)}static fromPositions(e,n=e){return new i(e.lineNumber,e.column,n.lineNumber,n.column)}static lift(e){return e?new i(e.startLineNumber,e.startColumn,e.endLineNumber,e.endColumn):null}static isIRange(e){return e&&typeof e.startLineNumber=="number"&&typeof e.startColumn=="number"&&typeof e.endLineNumber=="number"&&typeof e.endColumn=="number"}static areIntersectingOrTouching(e,n){return!(e.endLineNumber<n.startLineNumber||e.endLineNumber===n.startLineNumber&&e.endColumn<n.startColumn||n.endLineNumber<e.startLineNumber||n.endLineNumber===e.startLineNumber&&n.endColumn<e.startColumn)}static areIntersecting(e,n){return!(e.endLineNumber<n.startLineNumber||e.endLineNumber===n.startLineNumber&&e.endColumn<=n.startColumn||n.endLineNumber<e.startLineNumber||n.endLineNumber===e.startLineNumber&&n.endColumn<=e.startColumn)}static compareRangesUsingStarts(e,n){if(e&&n){let o=e.startLineNumber|0,s=n.startLineNumber|0;if(o===s){let u=e.startColumn|0,l=n.startColumn|0;if(u===l){let a=e.endLineNumber|0,m=n.endLineNumber|0;if(a===m){let f=e.endColumn|0,g=n.endColumn|0;return f-g}return a-m}return u-l}return o-s}return(e?1:0)-(n?1:0)}static compareRangesUsingEnds(e,n){return e.endLineNumber===n.endLineNumber?e.endColumn===n.endColumn?e.startLineNumber===n.startLineNumber?e.startColumn-n.startColumn:e.startLineNumber-n.startLineNumber:e.endColumn-n.endColumn:e.endLineNumber-n.endLineNumber}static spansMultipleLines(e){return e.endLineNumber>e.startLineNumber}toJSON(){return this}};var E=class i{static fromRange(e){return new i(e.startLineNumber,e.endLineNumber)}static fromRangeInclusive(e){return new i(e.startLineNumber,e.endLineNumber+1)}static subtract(e,n){return n?e.startLineNumber<n.startLineNumber&&n.endLineNumberExclusive<e.endLineNumberExclusive?[new i(e.startLineNumber,n.startLineNumber),new i(n.endLineNumberExclusive,e.endLineNumberExclusive)]:n.startLineNumber<=e.startLineNumber&&e.endLineNumberExclusive<=n.endLineNumberExclusive?[]:n.endLineNumberExclusive<e.endLineNumberExclusive?[new i(Math.max(n.endLineNumberExclusive,e.startLineNumber),e.endLineNumberExclusive)]:[new i(e.startLineNumber,Math.min(n.startLineNumber,e.endLineNumberExclusive))]:[e]}static joinMany(e){if(e.length===0)return[];let n=new k(e[0].slice());for(let t=1;t<e.length;t++)n=n.getUnion(new k(e[t].slice()));return n.ranges}static join(e){if(e.length===0)throw new S("lineRanges cannot be empty");let n=e[0].startLineNumber,t=e[0].endLineNumberExclusive;for(let r=1;r<e.length;r++)n=Math.min(n,e[r].startLineNumber),t=Math.max(t,e[r].endLineNumberExclusive);return new i(n,t)}static ofLength(e,n){return new i(e,e+n)}static deserialize(e){return new i(e[0],e[1])}constructor(e,n){if(e>n)throw new S(`startLineNumber ${e} cannot be after endLineNumberExclusive ${n}`);this.startLineNumber=e,this.endLineNumberExclusive=n}contains(e){return this.startLineNumber<=e&&e<this.endLineNumberExclusive}get isEmpty(){return this.startLineNumber===this.endLineNumberExclusive}delta(e){return new i(this.startLineNumber+e,this.endLineNumberExclusive+e)}deltaLength(e){return new i(this.startLineNumber,this.endLineNumberExclusive+e)}get length(){return this.endLineNumberExclusive-this.startLineNumber}join(e){return new i(Math.min(this.startLineNumber,e.startLineNumber),Math.max(this.endLineNumberExclusive,e.endLineNumberExclusive))}toString(){return`[${this.startLineNumber},${this.endLineNumberExclusive})`}intersect(e){let n=Math.max(this.startLineNumber,e.startLineNumber),t=Math.min(this.endLineNumberExclusive,e.endLineNumberExclusive);if(n<=t)return new i(n,t)}intersectsStrict(e){return this.startLineNumber<e.endLineNumberExclusive&&e.startLineNumber<this.endLineNumberExclusive}overlapOrTouch(e){return this.startLineNumber<=e.endLineNumberExclusive&&e.startLineNumber<=this.endLineNumberExclusive}equals(e){return this.startLineNumber===e.startLineNumber&&this.endLineNumberExclusive===e.endLineNumberExclusive}toInclusiveRange(){return this.isEmpty?null:new I(this.startLineNumber,1,this.endLineNumberExclusive-1,Number.MAX_SAFE_INTEGER)}toExclusiveRange(){return new I(this.startLineNumber,1,this.endLineNumberExclusive,1)}mapToLineArray(e){let n=[];for(let t=this.startLineNumber;t<this.endLineNumberExclusive;t++)n.push(e(t));return n}forEach(e){for(let n=this.startLineNumber;n<this.endLineNumberExclusive;n++)e(n)}serialize(){return[this.startLineNumber,this.endLineNumberExclusive]}includes(e){return this.startLineNumber<=e&&e<this.endLineNumberExclusive}toOffsetRange(){return new R(this.startLineNumber-1,this.endLineNumberExclusive-1)}},k=class i{constructor(e=[]){this._normalizedRanges=e}get ranges(){return this._normalizedRanges}addRange(e){if(e.length===0)return;let n=j(this._normalizedRanges,r=>r.endLineNumberExclusive>=e.startLineNumber),t=U(this._normalizedRanges,r=>r.startLineNumber<=e.endLineNumberExclusive)+1;if(n===t)this._normalizedRanges.splice(n,0,e);else if(n===t-1){let r=this._normalizedRanges[n];this._normalizedRanges[n]=r.join(e)}else{let r=this._normalizedRanges[n].join(this._normalizedRanges[t-1]).join(e);this._normalizedRanges.splice(n,t-n,r)}}contains(e){let n=O(this._normalizedRanges,t=>t.startLineNumber<=e);return!!n&&n.endLineNumberExclusive>e}intersects(e){let n=O(this._normalizedRanges,t=>t.startLineNumber<e.endLineNumberExclusive);return!!n&&n.endLineNumberExclusive>e.startLineNumber}getUnion(e){if(this._normalizedRanges.length===0)return e;if(e._normalizedRanges.length===0)return this;let n=[],t=0,r=0,o=null;for(;t<this._normalizedRanges.length||r<e._normalizedRanges.length;){let s=null;if(t<this._normalizedRanges.length&&r<e._normalizedRanges.length){let u=this._normalizedRanges[t],l=e._normalizedRanges[r];u.startLineNumber<l.startLineNumber?(s=u,t++):(s=l,r++)}else t<this._normalizedRanges.length?(s=this._normalizedRanges[t],t++):(s=e._normalizedRanges[r],r++);o===null?o=s:o.endLineNumberExclusive>=s.startLineNumber?o=new E(o.startLineNumber,Math.max(o.endLineNumberExclusive,s.endLineNumberExclusive)):(n.push(o),o=s)}return o!==null&&n.push(o),new i(n)}subtractFrom(e){let n=j(this._normalizedRanges,s=>s.endLineNumberExclusive>=e.startLineNumber),t=U(this._normalizedRanges,s=>s.startLineNumber<=e.endLineNumberExclusive)+1;if(n===t)return new i([e]);let r=[],o=e.startLineNumber;for(let s=n;s<t;s++){let u=this._normalizedRanges[s];u.startLineNumber>o&&r.push(new E(o,u.startLineNumber)),o=u.endLineNumberExclusive}return o<e.endLineNumberExclusive&&r.push(new E(o,e.endLineNumberExclusive)),new i(r)}toString(){return this._normalizedRanges.map(e=>e.toString()).join(", ")}getIntersection(e){let n=[],t=0,r=0;for(;t<this._normalizedRanges.length&&r<e._normalizedRanges.length;){let o=this._normalizedRanges[t],s=e._normalizedRanges[r],u=o.intersect(s);u&&!u.isEmpty&&n.push(u),o.endLineNumberExclusive<s.endLineNumberExclusive?t++:r++}return new i(n)}getWithDelta(e){return new i(this._normalizedRanges.map(n=>n.delta(e)))}};var D=class i{constructor(e,n){this.diffs=e;this.hitTimeout=n}static trivial(e,n){return new i([new y(R.ofLength(e.length),R.ofLength(n.length))],!1)}static trivialTimedOut(e,n){return new i([new y(R.ofLength(e.length),R.ofLength(n.length))],!0)}},y=class i{constructor(e,n){this.seq1Range=e;this.seq2Range=n}static invert(e,n){let t=[];return ye(e,(r,o)=>{t.push(i.fromOffsetPairs(r?r.getEndExclusives():M.zero,o?o.getStarts():new M(n,(r?r.seq2Range.endExclusive-r.seq1Range.endExclusive:0)+n)))}),t}static fromOffsetPairs(e,n){return new i(new R(e.offset1,n.offset1),new R(e.offset2,n.offset2))}swap(){return new i(this.seq2Range,this.seq1Range)}toString(){return`${this.seq1Range} <-> ${this.seq2Range}`}join(e){return new i(this.seq1Range.join(e.seq1Range),this.seq2Range.join(e.seq2Range))}delta(e){return e===0?this:new i(this.seq1Range.delta(e),this.seq2Range.delta(e))}deltaStart(e){return e===0?this:new i(this.seq1Range.deltaStart(e),this.seq2Range.deltaStart(e))}deltaEnd(e){return e===0?this:new i(this.seq1Range.deltaEnd(e),this.seq2Range.deltaEnd(e))}intersectsOrTouches(e){return this.seq1Range.intersectsOrTouches(e.seq1Range)||this.seq2Range.intersectsOrTouches(e.seq2Range)}intersect(e){let n=this.seq1Range.intersect(e.seq1Range),t=this.seq2Range.intersect(e.seq2Range);if(!(!n||!t))return new i(n,t)}getStarts(){return new M(this.seq1Range.start,this.seq2Range.start)}getEndExclusives(){return new M(this.seq1Range.endExclusive,this.seq2Range.endExclusive)}},M=class i{constructor(e,n){this.offset1=e;this.offset2=n}static{this.zero=new i(0,0)}static{this.max=new i(Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER)}toString(){return`${this.offset1} <-> ${this.offset2}`}delta(e){return e===0?this:new i(this.offset1+e,this.offset2+e)}equals(e){return this.offset1===e.offset1&&this.offset2===e.offset2}},q=class i{static{this.instance=new i}isValid(){return!0}},te=class{constructor(e){this.timeout=e;this.startTime=Date.now();this.valid=!0;if(e<=0)throw new S("timeout must be positive")}isValid(){if(!(Date.now()-this.startTime<this.timeout)&&this.valid){this.valid=!1;debugger}return this.valid}disable(){this.timeout=Number.MAX_SAFE_INTEGER,this.isValid=()=>!0,this.valid=!0}};var V=class{constructor(e,n){this.width=e;this.height=n;this.array=[];this.array=new Array(e*n)}get(e,n){return this.array[e+n*this.width]}set(e,n,t){this.array[e+n*this.width]=t}};function Z(i){return i===32||i===9}var Y=class i{constructor(e,n,t){this.range=e;this.lines=n;this.source=t;this.histogram=[];let r=0;for(let o=e.startLineNumber-1;o<e.endLineNumberExclusive-1;o++){let s=n[o];for(let l=0;l<s.length;l++){r++;let a=s[l],m=i.getKey(a);this.histogram[m]=(this.histogram[m]||0)+1}r++;let u=i.getKey(`
`);this.histogram[u]=(this.histogram[u]||0)+1}this.totalCount=r}static{this.chrKeys=new Map}static getKey(e){let n=this.chrKeys.get(e);return n===void 0&&(n=this.chrKeys.size,this.chrKeys.set(e,n)),n}computeSimilarity(e){let n=0,t=Math.max(this.histogram.length,e.histogram.length);for(let r=0;r<t;r++)n+=Math.abs((this.histogram[r]??0)-(e.histogram[r]??0));return 1-n/(this.totalCount+e.totalCount)}};var ie=class{compute(e,n,t=q.instance,r){if(e.length===0||n.length===0)return D.trivial(e,n);let o=new V(e.length,n.length),s=new V(e.length,n.length),u=new V(e.length,n.length);for(let b=0;b<e.length;b++)for(let p=0;p<n.length;p++){if(!t.isValid())return D.trivialTimedOut(e,n);let x=b===0?0:o.get(b-1,p),v=p===0?0:o.get(b,p-1),T;e.getElement(b)===n.getElement(p)?(b===0||p===0?T=0:T=o.get(b-1,p-1),b>0&&p>0&&s.get(b-1,p-1)===3&&(T+=u.get(b-1,p-1)),T+=r?r(b,p):1):T=-1;let N=Math.max(x,v,T);if(N===T){let _=b>0&&p>0?u.get(b-1,p-1):0;u.set(b,p,_+1),s.set(b,p,3)}else N===x?(u.set(b,p,0),s.set(b,p,1)):N===v&&(u.set(b,p,0),s.set(b,p,2));o.set(b,p,N)}let l=[],a=e.length,m=n.length;function f(b,p){(b+1!==a||p+1!==m)&&l.push(new y(new R(b+1,a),new R(p+1,m))),a=b,m=p}let g=e.length-1,c=n.length-1;for(;g>=0&&c>=0;)s.get(g,c)===3?(f(g,c),g--,c--):s.get(g,c)===1?g--:c--;return f(-1,-1),l.reverse(),new D(l,!1)}};var z=class{compute(e,n,t=q.instance){if(e.length===0||n.length===0)return D.trivial(e,n);let r=e,o=n;function s(p,x){for(;p<r.length&&x<o.length&&r.getElement(p)===o.getElement(x);)p++,x++;return p}let u=0,l=new pe;l.set(0,s(0,0));let a=new de;a.set(0,l.get(0)===0?null:new re(null,0,0,l.get(0)));let m=0;e:for(;;){if(u++,!t.isValid())return D.trivialTimedOut(r,o);let p=-Math.min(u,o.length+u%2),x=Math.min(u,r.length+u%2);for(m=p;m<=x;m+=2){let v=0,T=m===x?-1:l.get(m+1),N=m===p?-1:l.get(m-1)+1;v++;let _=Math.min(Math.max(T,N),r.length),d=_-m;if(v++,_>r.length||d>o.length)continue;let h=s(_,d);l.set(m,h);let L=_===T?a.get(m+1):a.get(m-1);if(a.set(m,h!==_?new re(L,_,d,h-_):L),l.get(m)===r.length&&l.get(m)-m===o.length)break e}}let f=a.get(m),g=[],c=r.length,b=o.length;for(;;){let p=f?f.x+f.length:0,x=f?f.y+f.length:0;if((p!==c||x!==b)&&g.push(new y(new R(p,c),new R(x,b))),!f)break;c=f.x,b=f.y,f=f.prev}return g.reverse(),new D(g,!1)}},re=class{constructor(e,n,t,r){this.prev=e;this.x=n;this.y=t;this.length=r}},pe=class{constructor(){this.positiveArr=new Int32Array(10);this.negativeArr=new Int32Array(10)}get(e){return e<0?(e=-e-1,this.negativeArr[e]):this.positiveArr[e]}set(e,n){if(e<0){if(e=-e-1,e>=this.negativeArr.length){let t=this.negativeArr;this.negativeArr=new Int32Array(t.length*2),this.negativeArr.set(t)}this.negativeArr[e]=n}else{if(e>=this.positiveArr.length){let t=this.positiveArr;this.positiveArr=new Int32Array(t.length*2),this.positiveArr.set(t)}this.positiveArr[e]=n}}},de=class{constructor(){this.positiveArr=[];this.negativeArr=[]}get(e){return e<0?(e=-e-1,this.negativeArr[e]):this.positiveArr[e]}set(e,n){e<0?(e=-e-1,this.negativeArr[e]=n):this.positiveArr[e]=n}};var se=class i{constructor(e,n){this.lineCount=e;this.columnCount=n}static{this.zero=new i(0,0)}static lengthDiffNonNegative(e,n){return n.isLessThan(e)?i.zero:e.lineCount===n.lineCount?new i(0,n.columnCount-e.columnCount):new i(n.lineCount-e.lineCount,n.columnCount)}static betweenPositions(e,n){return e.lineNumber===n.lineNumber?new i(0,n.column-e.column):new i(n.lineNumber-e.lineNumber,n.column-1)}static ofRange(e){return i.betweenPositions(e.getStartPosition(),e.getEndPosition())}static ofText(e){let n=0,t=0;for(let r of e)r===`
`?(n++,t=0):t++;return new i(n,t)}isZero(){return this.lineCount===0&&this.columnCount===0}isLessThan(e){return this.lineCount!==e.lineCount?this.lineCount<e.lineCount:this.columnCount<e.columnCount}isGreaterThan(e){return this.lineCount!==e.lineCount?this.lineCount>e.lineCount:this.columnCount>e.columnCount}isGreaterThanOrEqualTo(e){return this.lineCount!==e.lineCount?this.lineCount>e.lineCount:this.columnCount>=e.columnCount}equals(e){return this.lineCount===e.lineCount&&this.columnCount===e.columnCount}compare(e){return this.lineCount!==e.lineCount?this.lineCount-e.lineCount:this.columnCount-e.columnCount}add(e){return e.lineCount===0?new i(this.lineCount,this.columnCount+e.columnCount):new i(this.lineCount+e.lineCount,e.columnCount)}createRange(e){return this.lineCount===0?new I(e.lineNumber,e.column,e.lineNumber,e.column+this.columnCount):new I(e.lineNumber,e.column,e.lineNumber+this.lineCount,this.columnCount+1)}toRange(){return new I(1,1,this.lineCount+1,this.columnCount+1)}addToPosition(e){return this.lineCount===0?new A(e.lineNumber,e.column+this.columnCount):new A(e.lineNumber+this.lineCount,this.columnCount+1)}toString(){return`${this.lineCount},${this.columnCount}`}};var oe=class{constructor(e,n){this.range=e;this.text=n}get isEmpty(){return this.range.isEmpty()&&this.text.length===0}static equals(e,n){return e.range.equalsRange(n.range)&&e.text===n.text}toSingleEditOperation(){return{range:this.range,text:this.text}}};var P=class i{static inverse(e,n,t){let r=[],o=1,s=1;for(let l of e){let a=new i(new E(o,l.original.startLineNumber),new E(s,l.modified.startLineNumber));a.modified.isEmpty||r.push(a),o=l.original.endLineNumberExclusive,s=l.modified.endLineNumberExclusive}let u=new i(new E(o,n+1),new E(s,t+1));return u.modified.isEmpty||r.push(u),r}static clip(e,n,t){let r=[];for(let o of e){let s=o.original.intersect(n),u=o.modified.intersect(t);s&&!s.isEmpty&&u&&!u.isEmpty&&r.push(new i(s,u))}return r}constructor(e,n){this.original=e,this.modified=n}toString(){return`{${this.original.toString()}->${this.modified.toString()}}`}flip(){return new i(this.modified,this.original)}join(e){return new i(this.original.join(e.original),this.modified.join(e.modified))}get changedLineCount(){return Math.max(this.original.length,this.modified.length)}toRangeMapping(){let e=this.original.toInclusiveRange(),n=this.modified.toInclusiveRange();if(e&&n)return new F(e,n);if(this.original.startLineNumber===1||this.modified.startLineNumber===1){if(!(this.modified.startLineNumber===1&&this.original.startLineNumber===1))throw new S("not a valid diff");return new F(new I(this.original.startLineNumber,1,this.original.endLineNumberExclusive,1),new I(this.modified.startLineNumber,1,this.modified.endLineNumberExclusive,1))}else return new F(new I(this.original.startLineNumber-1,Number.MAX_SAFE_INTEGER,this.original.endLineNumberExclusive-1,Number.MAX_SAFE_INTEGER),new I(this.modified.startLineNumber-1,Number.MAX_SAFE_INTEGER,this.modified.endLineNumberExclusive-1,Number.MAX_SAFE_INTEGER))}},G=class i extends P{static fromRangeMappings(e){let n=E.join(e.map(r=>E.fromRangeInclusive(r.originalRange))),t=E.join(e.map(r=>E.fromRangeInclusive(r.modifiedRange)));return new i(n,t,e)}constructor(e,n,t){super(e,n),this.innerChanges=t}flip(){return new i(this.modified,this.original,this.innerChanges?.map(e=>e.flip()))}withInnerChangesFromLineRanges(){return new i(this.original,this.modified,[this.toRangeMapping()])}},F=class i{constructor(e,n){this.originalRange=e,this.modifiedRange=n}toString(){return`{${this.originalRange.toString()}->${this.modifiedRange.toString()}}`}flip(){return new i(this.modifiedRange,this.originalRange)}toTextEdit(e){let n=e.getValueOfRange(this.modifiedRange);return new oe(this.originalRange,n)}};var he=class{constructor(e,n){this.uri=e;this.value=n}};function Ce(i){return Array.isArray(i)}var en,ue=class i{constructor(e,n){this[en]="ResourceMap";if(e instanceof i)this.map=new Map(e.map),this.toKey=n??i.defaultToKey;else if(Ce(e)){this.map=new Map,this.toKey=n??i.defaultToKey;for(let[t,r]of e)this.set(t,r)}else this.map=new Map,this.toKey=e??i.defaultToKey}static{this.defaultToKey=e=>e.toString()}set(e,n){return this.map.set(this.toKey(e),new he(e,n)),this}get(e){return this.map.get(this.toKey(e))?.value}has(e){return this.map.has(this.toKey(e))}get size(){return this.map.size}clear(){this.map.clear()}delete(e){return this.map.delete(this.toKey(e))}forEach(e,n){typeof n<"u"&&(e=e.bind(n));for(let[t,r]of this.map)e(r.value,r.uri,this)}*values(){for(let e of this.map.values())yield e.value}*keys(){for(let e of this.map.values())yield e.uri}*entries(){for(let e of this.map.values())yield[e.uri,e.value]}*[(en=Symbol.toStringTag,Symbol.iterator)](){for(let[,e]of this.map)yield[e.uri,e.value]}},nn,Oe=class{constructor(e,n){this[nn]="ResourceSet";!e||typeof e=="function"?this._map=new ue(e):(this._map=new ue(n),e.forEach(this.add,this))}get size(){return this._map.size}add(e){return this._map.set(e,e),this}clear(){this._map.clear()}delete(e){return this._map.delete(e)}forEach(e,n){this._map.forEach((t,r)=>e.call(n,r,r,this))}has(e){return this._map.has(e)}entries(){return this._map.entries()}keys(){return this._map.keys()}values(){return this._map.keys()}[(nn=Symbol.toStringTag,Symbol.iterator)](){return this.keys()}};var tn,Ue=class{constructor(){this[tn]="LinkedMap";this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0,this._state=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0,this._state++}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}get first(){return this._head?.value}get last(){return this._tail?.value}has(e){return this._map.has(e)}get(e,n=0){let t=this._map.get(e);if(t)return n!==0&&this.touch(t,n),t.value}set(e,n,t=0){let r=this._map.get(e);if(r)r.value=n,t!==0&&this.touch(r,t);else{switch(r={key:e,value:n,next:void 0,previous:void 0},t){case 0:this.addItemLast(r);break;case 1:this.addItemFirst(r);break;case 2:this.addItemLast(r);break;default:this.addItemLast(r);break}this._map.set(e,r),this._size++}return this}delete(e){return!!this.remove(e)}remove(e){let n=this._map.get(e);if(n)return this._map.delete(e),this.removeItem(n),this._size--,n.value}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");let e=this._head;return this._map.delete(e.key),this.removeItem(e),this._size--,e.value}forEach(e,n){let t=this._state,r=this._head;for(;r;){if(n?e.bind(n)(r.value,r.key,this):e(r.value,r.key,this),this._state!==t)throw new Error("LinkedMap got modified during iteration.");r=r.next}}keys(){let e=this,n=this._state,t=this._head,r={[Symbol.iterator](){return r},next(){if(e._state!==n)throw new Error("LinkedMap got modified during iteration.");if(t){let o={value:t.key,done:!1};return t=t.next,o}else return{value:void 0,done:!0}}};return r}values(){let e=this,n=this._state,t=this._head,r={[Symbol.iterator](){return r},next(){if(e._state!==n)throw new Error("LinkedMap got modified during iteration.");if(t){let o={value:t.value,done:!1};return t=t.next,o}else return{value:void 0,done:!0}}};return r}entries(){let e=this,n=this._state,t=this._head,r={[Symbol.iterator](){return r},next(){if(e._state!==n)throw new Error("LinkedMap got modified during iteration.");if(t){let o={value:[t.key,t.value],done:!1};return t=t.next,o}else return{value:void 0,done:!0}}};return r}[(tn=Symbol.toStringTag,Symbol.iterator)](){return this.entries()}trimOld(e){if(e>=this.size)return;if(e===0){this.clear();return}let n=this._head,t=this.size;for(;n&&t>e;)this._map.delete(n.key),n=n.next,t--;this._head=n,this._size=t,n&&(n.previous=void 0),this._state++}trimNew(e){if(e>=this.size)return;if(e===0){this.clear();return}let n=this._tail,t=this.size;for(;n&&t>e;)this._map.delete(n.key),n=n.previous,t--;this._tail=n,this._size=t,n&&(n.next=void 0),this._state++}addItemFirst(e){if(!this._head&&!this._tail)this._tail=e;else if(this._head)e.next=this._head,this._head.previous=e;else throw new Error("Invalid list");this._head=e,this._state++}addItemLast(e){if(!this._head&&!this._tail)this._head=e;else if(this._tail)e.previous=this._tail,this._tail.next=e;else throw new Error("Invalid list");this._tail=e,this._state++}removeItem(e){if(e===this._head&&e===this._tail)this._head=void 0,this._tail=void 0;else if(e===this._head){if(!e.next)throw new Error("Invalid list");e.next.previous=void 0,this._head=e.next}else if(e===this._tail){if(!e.previous)throw new Error("Invalid list");e.previous.next=void 0,this._tail=e.previous}else{let n=e.next,t=e.previous;if(!n||!t)throw new Error("Invalid list");n.previous=t,t.next=n}e.next=void 0,e.previous=void 0,this._state++}touch(e,n){if(!this._head||!this._tail)throw new Error("Invalid list");if(!(n!==1&&n!==2)){if(n===1){if(e===this._head)return;let t=e.next,r=e.previous;e===this._tail?(r.next=void 0,this._tail=r):(t.previous=r,r.next=t),e.previous=void 0,e.next=this._head,this._head.previous=e,this._head=e,this._state++}else if(n===2){if(e===this._tail)return;let t=e.next,r=e.previous;e===this._head?(t.previous=void 0,this._head=t):(t.previous=r,r.next=t),e.next=void 0,e.previous=this._tail,this._tail.next=e,this._tail=e,this._state++}}}toJSON(){let e=[];return this.forEach((n,t)=>{e.push([t,n])}),e}fromJSON(e){this.clear();for(let[n,t]of e)this.set(n,t)}};var le=class{constructor(){this.map=new Map}add(e,n){let t=this.map.get(e);t||(t=new Set,this.map.set(e,t)),t.add(n)}delete(e,n){let t=this.map.get(e);t&&(t.delete(n),t.size===0&&this.map.delete(e))}forEach(e,n){let t=this.map.get(e);t&&t.forEach(n)}get(e){let n=this.map.get(e);return n||new Set}};var B=class{constructor(e,n,t){this.lines=e;this.considerWhitespaceChanges=t;this.elements=[];this.firstCharOffsetByLine=[];this.additionalOffsetByLine=[];let r=!1;n.start>0&&n.endExclusive>=e.length&&(n=new R(n.start-1,n.endExclusive),r=!0),this.lineRange=n,this.firstCharOffsetByLine[0]=0;for(let o=this.lineRange.start;o<this.lineRange.endExclusive;o++){let s=e[o],u=0;if(r)u=s.length,s="",r=!1;else if(!t){let l=s.trimStart();u=s.length-l.length,s=l.trimEnd()}this.additionalOffsetByLine.push(u);for(let l=0;l<s.length;l++)this.elements.push(s.charCodeAt(l));o<e.length-1&&(this.elements.push(10),this.firstCharOffsetByLine[o-this.lineRange.start+1]=this.elements.length)}this.additionalOffsetByLine.push(0)}toString(){return`Slice: "${this.text}"`}get text(){return this.getText(new R(0,this.length))}getText(e){return this.elements.slice(e.start,e.endExclusive).map(n=>String.fromCharCode(n)).join("")}getElement(e){return this.elements[e]}get length(){return this.elements.length}getBoundaryScore(e){let n=Fe(e>0?this.elements[e-1]:-1),t=Fe(e<this.elements.length?this.elements[e]:-1);if(n===7&&t===8)return 0;if(n===8)return 150;let r=0;return n!==t&&(r+=10,n===0&&t===1&&(r+=1)),r+=qe(n),r+=qe(t),r}translateOffset(e){if(this.lineRange.isEmpty)return new A(this.lineRange.start+1,1);let n=U(this.firstCharOffsetByLine,t=>t<=e);return new A(this.lineRange.start+n+1,e-this.firstCharOffsetByLine[n]+this.additionalOffsetByLine[n]+1)}translateRange(e){return I.fromPositions(this.translateOffset(e.start),this.translateOffset(e.endExclusive))}findWordContaining(e){if(e<0||e>=this.elements.length||!Re(this.elements[e]))return;let n=e;for(;n>0&&Re(this.elements[n-1]);)n--;let t=e;for(;t<this.elements.length&&Re(this.elements[t]);)t++;return new R(n,t)}countLinesIn(e){return this.translateOffset(e.endExclusive).lineNumber-this.translateOffset(e.start).lineNumber}isStronglyEqual(e,n){return this.elements[e]===this.elements[n]}extendToFullLines(e){let n=O(this.firstCharOffsetByLine,r=>r<=e.start)??0,t=Te(this.firstCharOffsetByLine,r=>e.endExclusive<=r)??this.elements.length;return new R(n,t)}};function Re(i){return i>=97&&i<=122||i>=65&&i<=90||i>=48&&i<=57}var rn={0:0,1:0,2:0,3:10,4:2,5:30,6:3,7:10,8:10};function qe(i){return rn[i]}function Fe(i){return i===10?8:i===13?7:Z(i)?6:i>=97&&i<=122?0:i>=65&&i<=90?1:i>=48&&i<=57?2:i===-1?3:i===44||i===59?5:4}function Be(i,e,n,t,r,o){let{moves:s,excludedChanges:u}=on(i,e,n,o);if(!o.isValid())return[];let l=i.filter(m=>!u.has(m)),a=un(l,t,r,e,n,o);return Se(s,a),s=ln(s),s=s.filter(m=>{let f=m.original.toOffsetRange().slice(e).map(c=>c.trim());return f.join(`
`).length>=15&&sn(f,c=>c.length>=2)>=2}),s=an(i,s),s}function sn(i,e){let n=0;for(let t of i)e(t)&&n++;return n}function on(i,e,n,t){let r=[],o=i.filter(l=>l.modified.isEmpty&&l.original.length>=3).map(l=>new Y(l.original,e,l)),s=new Set(i.filter(l=>l.original.isEmpty&&l.modified.length>=3).map(l=>new Y(l.modified,n,l))),u=new Set;for(let l of o){let a=-1,m;for(let f of s){let g=l.computeSimilarity(f);g>a&&(a=g,m=f)}if(a>.9&&m&&(s.delete(m),r.push(new P(l.range,m.range)),u.add(l.source),u.add(m.source)),!t.isValid())return{moves:r,excludedChanges:u}}return{moves:r,excludedChanges:u}}function un(i,e,n,t,r,o){let s=[],u=new le;for(let g of i)for(let c=g.original.startLineNumber;c<g.original.endLineNumberExclusive-2;c++){let b=`${e[c-1]}:${e[c+1-1]}:${e[c+2-1]}`;u.add(b,{range:new E(c,c+3)})}let l=[];i.sort($(g=>g.modified.startLineNumber,X));for(let g of i){let c=[];for(let b=g.modified.startLineNumber;b<g.modified.endLineNumberExclusive-2;b++){let p=`${n[b-1]}:${n[b+1-1]}:${n[b+2-1]}`,x=new E(b,b+3),v=[];u.forEach(p,({range:T})=>{for(let _ of c)if(_.originalLineRange.endLineNumberExclusive+1===T.endLineNumberExclusive&&_.modifiedLineRange.endLineNumberExclusive+1===x.endLineNumberExclusive){_.originalLineRange=new E(_.originalLineRange.startLineNumber,T.endLineNumberExclusive),_.modifiedLineRange=new E(_.modifiedLineRange.startLineNumber,x.endLineNumberExclusive),v.push(_);return}let N={modifiedLineRange:x,originalLineRange:T};l.push(N),v.push(N)}),c=v}if(!o.isValid())return[]}l.sort(Me($(g=>g.modifiedLineRange.length,X)));let a=new k,m=new k;for(let g of l){let c=g.modifiedLineRange.startLineNumber-g.originalLineRange.startLineNumber,b=a.subtractFrom(g.modifiedLineRange),p=m.subtractFrom(g.originalLineRange).getWithDelta(c),x=b.getIntersection(p);for(let v of x.ranges){if(v.length<3)continue;let T=v,N=v.delta(-c);s.push(new P(N,T)),a.addRange(T),m.addRange(N)}}s.sort($(g=>g.original.startLineNumber,X));let f=new H(i);for(let g=0;g<s.length;g++){let c=s[g],b=f.findLastMonotonous(h=>h.original.startLineNumber<=c.original.startLineNumber),p=O(i,h=>h.modified.startLineNumber<=c.modified.startLineNumber),x=Math.max(c.original.startLineNumber-b.original.startLineNumber,c.modified.startLineNumber-p.modified.startLineNumber),v=f.findLastMonotonous(h=>h.original.startLineNumber<c.original.endLineNumberExclusive),T=O(i,h=>h.modified.startLineNumber<c.modified.endLineNumberExclusive),N=Math.max(v.original.endLineNumberExclusive-c.original.endLineNumberExclusive,T.modified.endLineNumberExclusive-c.modified.endLineNumberExclusive),_;for(_=0;_<x;_++){let h=c.original.startLineNumber-_-1,L=c.modified.startLineNumber-_-1;if(h>t.length||L>r.length||a.contains(L)||m.contains(h)||!Pe(t[h-1],r[L-1],o))break}_>0&&(m.addRange(new E(c.original.startLineNumber-_,c.original.startLineNumber)),a.addRange(new E(c.modified.startLineNumber-_,c.modified.startLineNumber)));let d;for(d=0;d<N;d++){let h=c.original.endLineNumberExclusive+d,L=c.modified.endLineNumberExclusive+d;if(h>t.length||L>r.length||a.contains(L)||m.contains(h)||!Pe(t[h-1],r[L-1],o))break}d>0&&(m.addRange(new E(c.original.endLineNumberExclusive,c.original.endLineNumberExclusive+d)),a.addRange(new E(c.modified.endLineNumberExclusive,c.modified.endLineNumberExclusive+d))),(_>0||d>0)&&(s[g]=new P(new E(c.original.startLineNumber-_,c.original.endLineNumberExclusive+d),new E(c.modified.startLineNumber-_,c.modified.endLineNumberExclusive+d)))}return s}function Pe(i,e,n){if(i.trim()===e.trim())return!0;if(i.length>300&&e.length>300)return!1;let r=new z().compute(new B([i],new R(0,1),!1),new B([e],new R(0,1),!1),n),o=0,s=y.invert(r.diffs,i.length);for(let m of s)m.seq1Range.forEach(f=>{Z(i.charCodeAt(f))||o++});function u(m){let f=0;for(let g=0;g<i.length;g++)Z(m.charCodeAt(g))||f++;return f}let l=u(i.length>e.length?i:e);return o/l>.6&&l>10}function ln(i){if(i.length===0)return i;i.sort($(n=>n.original.startLineNumber,X));let e=[i[0]];for(let n=1;n<i.length;n++){let t=e[e.length-1],r=i[n],o=r.original.startLineNumber-t.original.endLineNumberExclusive,s=r.modified.startLineNumber-t.modified.endLineNumberExclusive;if(o>=0&&s>=0&&o+s<=2){e[e.length-1]=t.join(r);continue}e.push(r)}return e}function an(i,e){let n=new H(i);return e=e.filter(t=>{let r=n.findLastMonotonous(u=>u.original.startLineNumber<t.original.endLineNumberExclusive)||new P(new E(1,1),new E(1,1)),o=O(i,u=>u.modified.startLineNumber<t.modified.endLineNumberExclusive);return r!==o}),e}function xe(i,e,n){let t=n;return t=Ke(i,e,t),t=Ke(i,e,t),t=mn(i,e,t),t}function Ke(i,e,n){if(n.length===0)return n;let t=[];t.push(n[0]);for(let o=1;o<n.length;o++){let s=t[t.length-1],u=n[o];if(u.seq1Range.isEmpty||u.seq2Range.isEmpty){let l=u.seq1Range.start-s.seq1Range.endExclusive,a;for(a=1;a<=l&&!(i.getElement(u.seq1Range.start-a)!==i.getElement(u.seq1Range.endExclusive-a)||e.getElement(u.seq2Range.start-a)!==e.getElement(u.seq2Range.endExclusive-a));a++);if(a--,a===l){t[t.length-1]=new y(new R(s.seq1Range.start,u.seq1Range.endExclusive-l),new R(s.seq2Range.start,u.seq2Range.endExclusive-l));continue}u=u.delta(-a)}t.push(u)}let r=[];for(let o=0;o<t.length-1;o++){let s=t[o+1],u=t[o];if(u.seq1Range.isEmpty||u.seq2Range.isEmpty){let l=s.seq1Range.start-u.seq1Range.endExclusive,a;for(a=0;a<l&&!(!i.isStronglyEqual(u.seq1Range.start+a,u.seq1Range.endExclusive+a)||!e.isStronglyEqual(u.seq2Range.start+a,u.seq2Range.endExclusive+a));a++);if(a===l){t[o+1]=new y(new R(u.seq1Range.start+l,s.seq1Range.endExclusive),new R(u.seq2Range.start+l,s.seq2Range.endExclusive));continue}a>0&&(u=u.delta(a))}r.push(u)}return t.length>0&&r.push(t[t.length-1]),r}function mn(i,e,n){if(!i.getBoundaryScore||!e.getBoundaryScore)return n;for(let t=0;t<n.length;t++){let r=t>0?n[t-1]:void 0,o=n[t],s=t+1<n.length?n[t+1]:void 0,u=new R(r?r.seq1Range.endExclusive+1:0,s?s.seq1Range.start-1:i.length),l=new R(r?r.seq2Range.endExclusive+1:0,s?s.seq2Range.start-1:e.length);o.seq1Range.isEmpty?n[t]=ke(o,i,e,u,l):o.seq2Range.isEmpty&&(n[t]=ke(o.swap(),e,i,l,u).swap())}return n}function ke(i,e,n,t,r){let s=1;for(;i.seq1Range.start-s>=t.start&&i.seq2Range.start-s>=r.start&&n.isStronglyEqual(i.seq2Range.start-s,i.seq2Range.endExclusive-s)&&s<100;)s++;s--;let u=0;for(;i.seq1Range.start+u<t.endExclusive&&i.seq2Range.endExclusive+u<r.endExclusive&&n.isStronglyEqual(i.seq2Range.start+u,i.seq2Range.endExclusive+u)&&u<100;)u++;if(s===0&&u===0)return i;let l=0,a=-1;for(let m=-s;m<=u;m++){let f=i.seq2Range.start+m,g=i.seq2Range.endExclusive+m,c=i.seq1Range.start+m,b=e.getBoundaryScore(c)+n.getBoundaryScore(f)+n.getBoundaryScore(g);b>a&&(a=b,l=m)}return i.delta(l)}function Ve(i,e,n){let t=[];for(let r of n){let o=t[t.length-1];if(!o){t.push(r);continue}r.seq1Range.start-o.seq1Range.endExclusive<=2||r.seq2Range.start-o.seq2Range.endExclusive<=2?t[t.length-1]=new y(o.seq1Range.join(r.seq1Range),o.seq2Range.join(r.seq2Range)):t.push(r)}return t}function ze(i,e,n){let t=y.invert(n,i.length),r=[],o=new M(0,0);function s(l,a){if(l.offset1<o.offset1||l.offset2<o.offset2)return;let m=i.findWordContaining(l.offset1),f=e.findWordContaining(l.offset2);if(!m||!f)return;let g=new y(m,f),c=g.intersect(a),b=c.seq1Range.length,p=c.seq2Range.length;for(;t.length>0;){let x=t[0];if(!(x.seq1Range.intersects(g.seq1Range)||x.seq2Range.intersects(g.seq2Range)))break;let T=i.findWordContaining(x.seq1Range.start),N=e.findWordContaining(x.seq2Range.start),_=new y(T,N),d=_.intersect(x);if(b+=d.seq1Range.length,p+=d.seq2Range.length,g=g.join(_),g.seq1Range.endExclusive>=x.seq1Range.endExclusive)t.shift();else break}b+p<(g.seq1Range.length+g.seq2Range.length)*2/3&&r.push(g),o=g.getEndExclusives()}for(;t.length>0;){let l=t.shift();l.seq1Range.isEmpty||(s(l.getStarts(),l),s(l.getEndExclusives().delta(-1),l))}return cn(n,r)}function cn(i,e){let n=[];for(;i.length>0||e.length>0;){let t=i[0],r=e[0],o;t&&(!r||t.seq1Range.start<r.seq1Range.start)?o=i.shift():o=e.shift(),n.length>0&&n[n.length-1].seq1Range.endExclusive>=o.seq1Range.start?n[n.length-1]=n[n.length-1].join(o):n.push(o)}return n}function Ge(i,e,n){let t=n;if(t.length===0)return t;let r=0,o;do{o=!1;let u=[t[0]];for(let l=1;l<t.length;l++){let f=function(c,b){let p=new R(m.seq1Range.endExclusive,a.seq1Range.start);return i.getText(p).replace(/\s/g,"").length<=4&&(c.seq1Range.length+c.seq2Range.length>5||b.seq1Range.length+b.seq2Range.length>5)};var s=f;let a=t[l],m=u[u.length-1];f(m,a)?(o=!0,u[u.length-1]=u[u.length-1].join(a)):u.push(a)}t=u}while(r++<10&&o);return t}function We(i,e,n){let t=n;if(t.length===0)return t;let r=0,o;do{o=!1;let l=[t[0]];for(let a=1;a<t.length;a++){let g=function(b,p){let x=new R(f.seq1Range.endExclusive,m.seq1Range.start);if(i.countLinesIn(x)>5||x.length>500)return!1;let T=i.getText(x).trim();if(T.length>20||T.split(/\r\n|\r|\n/).length>1)return!1;let N=i.countLinesIn(b.seq1Range),_=b.seq1Range.length,d=e.countLinesIn(b.seq2Range),h=b.seq2Range.length,L=i.countLinesIn(p.seq1Range),w=p.seq1Range.length,K=e.countLinesIn(p.seq2Range),ce=p.seq2Range.length,Le=2*40+50;function C(Xe){return Math.min(Xe,Le)}return Math.pow(Math.pow(C(N*40+_),1.5)+Math.pow(C(d*40+h),1.5),1.5)+Math.pow(Math.pow(C(L*40+w),1.5)+Math.pow(C(K*40+ce),1.5),1.5)>(Le**1.5)**1.5*1.3};var u=g;let m=t[a],f=l[l.length-1];g(f,m)?(o=!0,l[l.length-1]=l[l.length-1].join(m)):l.push(m)}t=l}while(r++<10&&o);let s=[];return we(t,(l,a,m)=>{let f=a;function g(T){return T.length>0&&T.trim().length<=3&&a.seq1Range.length+a.seq2Range.length>100}let c=i.extendToFullLines(a.seq1Range),b=i.getText(new R(c.start,a.seq1Range.start));g(b)&&(f=f.deltaStart(-b.length));let p=i.getText(new R(a.seq1Range.endExclusive,c.endExclusive));g(p)&&(f=f.deltaEnd(p.length));let x=y.fromOffsetPairs(l?l.getEndExclusives():M.zero,m?m.getStarts():M.max),v=f.intersect(x);s.length>0&&v.getStarts().equals(s[s.length-1].getEndExclusives())?s[s.length-1]=s[s.length-1].join(v):s.push(v)}),s}var Q=class{constructor(e,n){this.trimmedHash=e;this.lines=n}getElement(e){return this.trimmedHash[e]}get length(){return this.trimmedHash.length}getBoundaryScore(e){let n=e===0?0:He(this.lines[e-1]),t=e===this.lines.length?0:He(this.lines[e]);return 1e3-(n+t)}getText(e){return this.lines.slice(e.start,e.endExclusive).join(`
`)}isStronglyEqual(e,n){return this.lines[e]===this.lines[n]}};function He(i){let e=0;for(;e<i.length&&(i.charCodeAt(e)===32||i.charCodeAt(e)===9);)e++;return e}var W=class{constructor(e,n,t){this.changes=e;this.moves=n;this.hitTimeout=t}},ae=class i{constructor(e,n){this.lineRangeMapping=e,this.changes=n}flip(){return new i(this.lineRangeMapping.flip(),this.changes.map(e=>e.flip()))}};var me=class{constructor(){this.dynamicProgrammingDiffing=new ie;this.myersDiffingAlgorithm=new z}computeDiff(e,n,t){if(e.length<=1&&Ne(e,n,(d,h)=>d===h))return new W([],[],!1);if(e.length===1&&e[0].length===0||n.length===1&&n[0].length===0)return new W([new G(new E(1,e.length+1),new E(1,n.length+1),[new F(new I(1,1,e.length,e[e.length-1].length+1),new I(1,1,n.length,n[n.length-1].length+1))])],[],!1);let r=t.maxComputationTimeMs===0?q.instance:new te(t.maxComputationTimeMs),o=!t.ignoreTrimWhitespace,s=new Map;function u(d){let h=s.get(d);return h===void 0&&(h=s.size,s.set(d,h)),h}let l=e.map(d=>u(d.trim())),a=n.map(d=>u(d.trim())),m=new Q(l,e),f=new Q(a,n),g=m.length+f.length<1700?this.dynamicProgrammingDiffing.compute(m,f,r,(d,h)=>e[d]===n[h]?n[h].length===0?.1:1+Math.log(1+n[h].length):.99):this.myersDiffingAlgorithm.compute(m,f,r),c=g.diffs,b=g.hitTimeout;c=xe(m,f,c),c=Ge(m,f,c);let p=[],x=d=>{if(o)for(let h=0;h<d;h++){let L=v+h,w=T+h;if(e[L]!==n[w]){let K=this.refineDiff(e,n,new y(new R(L,L+1),new R(w,w+1)),r,o);for(let ce of K.mappings)p.push(ce);K.hitTimeout&&(b=!0)}}},v=0,T=0;for(let d of c){J(()=>d.seq1Range.start-v===d.seq2Range.start-T);let h=d.seq1Range.start-v;x(h),v=d.seq1Range.endExclusive,T=d.seq2Range.endExclusive;let L=this.refineDiff(e,n,d,r,o);L.hitTimeout&&(b=!0);for(let w of L.mappings)p.push(w)}x(e.length-v);let N=je(p,e,n),_=[];return t.computeMoves&&(_=this.computeMoves(N,e,n,l,a,r,o)),J(()=>{function d(L,w){if(L.lineNumber<1||L.lineNumber>w.length)return!1;let K=w[L.lineNumber-1];return!(L.column<1||L.column>K.length+1)}function h(L,w){return!(L.startLineNumber<1||L.startLineNumber>w.length+1||L.endLineNumberExclusive<1||L.endLineNumberExclusive>w.length+1)}for(let L of N){if(!L.innerChanges)return!1;for(let w of L.innerChanges)if(!(d(w.modifiedRange.getStartPosition(),n)&&d(w.modifiedRange.getEndPosition(),n)&&d(w.originalRange.getStartPosition(),e)&&d(w.originalRange.getEndPosition(),e)))return!1;if(!h(L.modified,n)||!h(L.original,e))return!1}return!0}),new W(N,_,b)}computeMoves(e,n,t,r,o,s,u){return Be(e,n,t,r,o,s).map(m=>{let f=this.refineDiff(n,t,new y(m.original.toOffsetRange(),m.modified.toOffsetRange()),s,u),g=je(f.mappings,n,t,!0);return new ae(m,g)})}refineDiff(e,n,t,r,o){let s=new B(e,t.seq1Range,o),u=new B(n,t.seq2Range,o),l=s.length+u.length<500?this.dynamicProgrammingDiffing.compute(s,u,r):this.myersDiffingAlgorithm.compute(s,u,r),a=l.diffs;return a=xe(s,u,a),a=ze(s,u,a),a=Ve(s,u,a),a=We(s,u,a),{mappings:a.map(f=>new F(s.translateRange(f.seq1Range),u.translateRange(f.seq2Range))),hitTimeout:l.hitTimeout}}};function je(i,e,n,t=!1){let r=[];for(let o of Ie(i.map(s=>fn(s,e,n)),(s,u)=>s.original.overlapOrTouch(u.original)||s.modified.overlapOrTouch(u.modified))){let s=o[0],u=o[o.length-1];r.push(new G(s.original.join(u.original),s.modified.join(u.modified),o.map(l=>l.innerChanges[0])))}return J(()=>!t&&r.length>0&&(r[0].modified.startLineNumber!==r[0].original.startLineNumber||n.length-r[r.length-1].modified.endLineNumberExclusive!==e.length-r[r.length-1].original.endLineNumberExclusive)?!1:be(r,(o,s)=>s.original.startLineNumber-o.original.endLineNumberExclusive===s.modified.startLineNumber-o.modified.endLineNumberExclusive&&o.original.endLineNumberExclusive<s.original.startLineNumber&&o.modified.endLineNumberExclusive<s.modified.startLineNumber)),r}function fn(i,e,n){let t=0,r=0;i.modifiedRange.endColumn===1&&i.originalRange.endColumn===1&&i.originalRange.startLineNumber+t<=i.originalRange.endLineNumber&&i.modifiedRange.startLineNumber+t<=i.modifiedRange.endLineNumber&&(r=-1),i.modifiedRange.startColumn-1>=n[i.modifiedRange.startLineNumber-1].length&&i.originalRange.startColumn-1>=e[i.originalRange.startLineNumber-1].length&&i.originalRange.startLineNumber<=i.originalRange.endLineNumber+r&&i.modifiedRange.startLineNumber<=i.modifiedRange.endLineNumber+r&&(t=1);let o=new E(i.originalRange.startLineNumber+t,i.originalRange.endLineNumber+1+r),s=new E(i.modifiedRange.startLineNumber+t,i.modifiedRange.endLineNumber+1+r);return new G(o,s,[i])}async function gn(i,e,n){let t=i.split(/\r\n|\r|\n/),r=e.split(/\r\n|\r|\n/),s=new me().computeDiff(t,r,n),u=s.changes.length>0?!1:i===e;function l(a){return a.map(m=>[m.original.startLineNumber,m.original.endLineNumberExclusive,m.modified.startLineNumber,m.modified.endLineNumberExclusive,m.innerChanges?.map(f=>[f.originalRange.startLineNumber,f.originalRange.startColumn,f.originalRange.endLineNumber,f.originalRange.endColumn,f.modifiedRange.startLineNumber,f.modifiedRange.startColumn,f.modifiedRange.endLineNumber,f.modifiedRange.endColumn])])}return{identical:u,quitEarly:s.hitTimeout,changes:l(s.changes),moves:s.moves.map(a=>[a.lineRangeMapping.original.startLineNumber,a.lineRangeMapping.original.endLineNumberExclusive,a.lineRangeMapping.modified.startLineNumber,a.lineRangeMapping.modified.endLineNumberExclusive,l(a.changes)])}}function bn(){let i=$e.parentPort;if(!i)throw new Error("This module should only be used in a worker thread.");i.on("message",async({id:e,fn:n,args:t})=>{try{let r=await _e[n](...t);i.postMessage({id:e,res:r})}catch(r){i.postMessage({id:e,err:r})}})}bn();
//!!! DO NOT modify, this file was COPIED from 'microsoft/vscode'
